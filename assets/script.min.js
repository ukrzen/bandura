"use strict";Array.prototype.random=function(){return this[Math.floor(Math.random()*this.length)]},$(function(){var o=!1,n={},e="ontouchstart"in window,t=navigator.userAgent.match(/iPhone|iPad|iPod/i),d=-1!=location.search.indexOf("simple");Howler.mobileAutoEnable=!1;var i=e,a=0,s=(location.search.indexOf("v=2"),0);$("body").addClass(e?"mobile":"desktop"),d&&$("body").addClass("simple"),e&&$("body").addClass(t?"ios":"non-ios"),document.body.addEventListener("touchmove",function(o){o.preventDefault()},{passive:!1});var r={};$("body").on(e?"touchstart":"mousedown",".line",function(o){m(this,!0),o.stopImmediatePropagation()}),e||$("body").on("mouseover",".line",function(o){(o.buttons||void 0===o.buttons&&0!==o.originalEvent.which)&&(m(this),o.stopImmediatePropagation())});var c,l,h=!1;function p(){return window.performance&&window.performance.now&&window.performance.timing&&window.performance.timing.navigationStart?window.performance.now()+window.performance.timing.navigationStart:Date.now()}function u(o,n){for(var e=0;e<o.length;e++)!function(){var n=o[e];setTimeout(function(){var o=jQuery.Event(n[0]>0?"keydown":"keyup");o.keyCode=Math.abs(n[0]),$(window).trigger(o)},n[1])}()}function m(o,e){var t=parseInt($(o).data("note"));$(o).addClass("clicked"),r[t]=!0,n[t].play(),++a>10&&$("#sound-help").addClass("hidden"),$(this).one("animationend webkitAnimationEnd MSAnimationEnd oAnimationEnd",function(n){$(o).removeClass("clicked"),r[t]=!1})}$("#sound-help").appendTo(".container");var w=21;function f(){0==--w&&($(".hello.screen").addClass("ready"),$(".bandura.screen").addClass("ready"),$(".not-ready").removeClass("not-ready"),o=!0,location.hash&&u(l=JSON.parse(atob(location.hash.slice(1)))))}for(var g=1;g<=21;g++)n[g]=new Howl({src:["samples/mp3/"+g+".mp3","samples/ogg/"+g+".ogg"],pool:32,onload:f,onloaderror:function(){n[g]=null,f()}});$(".sound.screen").on("click",function(){$(".sound.screen").addClass("hidden"),$("#sound-help").removeClass("hidden")}),$(".hello.screen").on("click",function(){o&&($(".hello.screen").addClass("hidden"),i&&$(".sound.screen").addClass("ready"))}),$(".help.screen").on("click",function(){$(".help.screen").addClass("hidden")}),$("#sound-help").on("click",function(){$(".help.screen").removeClass("hidden")});var v={65:1,83:2,68:3,70:4,71:5,72:6,74:7,75:8,76:9,186:10,222:11,90:12,88:13,67:14,86:15,66:16,78:17,77:18,188:19,190:20,191:21},b={};$(".bandura .info").on("click",function(){$(".screen.info").removeClass("hidden").addClass("ready")}),$(".screen.info").on("click",function(){$(".screen.info").removeClass("ready"),$(".screen.info").one("transitionend",function(o){$(this).addClass("hidden")})}),$(".screen .record").on("click",function(){$(".screen .record").toggleClass("active"),h?(h=!1,$(".screen .play").removeClass("disabled")):(l=[],h=!0,c=p())}),$(".screen .play").on("click",function(){u(l)}),$(window).on("keydown",function(o){if(b[o.keyCode]=!0,h){var n=p();l.push([o.keyCode,Math.round(n-c,3)])}}),$(window).on("keyup",function(o){if(b[o.keyCode]=!1,h){var n=p();l.push([-o.keyCode,Math.round(n-c,3)])}}),$(window).on("keydown",function(o){Object.keys(v).forEach(function(o){b[o]&&$(".line[data-note="+v[o]+"]").trigger("mousedown").trigger("touchstart")})});for(var y={1:{x:197,width:4},2:{x:221,width:4},3:{x:246,width:2.5},4:{x:269,width:2.5},5:{x:292,width:1.5,top:46,deg:.1},6:{x:317,width:1.5,top:78,deg:.9},7:{x:342,width:1.5,top:110,deg:1.7},8:{x:366,width:1.5,deg:2.5,top:140},9:{x:394,width:1.5,deg:3.7,top:172},10:{x:415,width:1.5,deg:5,top:204},11:{x:441,width:1.5,deg:6.5,top:237},12:{x:465,width:1.5,deg:8.5,top:267},13:{x:487,width:1.5,deg:10.5,top:296},14:{x:508,width:1.5,deg:13,top:330,bottom:-11},15:{x:531,width:1.5,deg:15,top:360,bottom:-11},16:{x:551,width:1.5,deg:17,top:393,bottom:-11},17:{x:569,width:1,deg:19,top:428,bottom:-11},18:{x:587,width:1,deg:21,top:466,bottom:-11},19:{x:601,width:1,deg:23.5,top:508,bottom:-21},20:{x:615,width:1,deg:25.9,top:546,bottom:-21},21:{x:626,width:1,deg:28.2,top:590,bottom:-21}},x=1;x<=21;x++){var C=$("<div class='line' onclick=''><div>  <div></div>  </div></div>"),k=y[x],E=k.width;C.css("left",k.x+"px"),C.css("top",(k.top||-20)+"px"),C.css("bottom","0px"),C.css("width",E+"px"),k.deg&&C.css("transform","rotate("+k.deg+"deg)"),k.bottom&&C.css("bottom",k.bottom+"px"),C.attr("data-note",x),C.appendTo($(".content "))}e&&$("body").on("touchmove",".line",function(o){var n=$(document.elementFromPoint(o.originalEvent.touches[0].pageX,o.originalEvent.touches[0].pageY));n.length&&(n.is(".line")||(n=n.parents(".line")));var e=parseInt($(n).data("note"));e&&e!=s&&(s=e,m(n)),o.preventDefault()})});